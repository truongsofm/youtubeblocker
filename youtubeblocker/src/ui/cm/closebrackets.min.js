!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(b){var n={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},C=b.Pos;function x(e,t){return"pairs"==t&&"string"==typeof e?e:("object"==typeof e&&null!=e[t]?e:n)[t]}b.defineOption("autoCloseBrackets",!1,function(e,t,n){n&&n!=b.Init&&(e.removeKeyMap(i),e.state.closeBrackets=null),t&&(r(x(t,"pairs")),e.state.closeBrackets=t,e.addKeyMap(i))});var i={Backspace:function(e){var t=P(e);if(!t||e.getOption("disableInput"))return b.Pass;for(var n=x(t,"pairs"),r=e.listSelections(),i=0;i<r.length;i++){if(!r[i].empty())return b.Pass;var o=s(e,r[i].head);if(!o||n.indexOf(o)%2!=0)return b.Pass}for(i=r.length-1;0<=i;i--){var a=r[i].head;e.replaceRange("",C(a.line,a.ch-1),C(a.line,a.ch+1),"+delete")}},Enter:function(r){var e=P(r),t=e&&x(e,"explode");if(!t||r.getOption("disableInput"))return b.Pass;for(var i=r.listSelections(),n=0;n<i.length;n++){if(!i[n].empty())return b.Pass;var o=s(r,i[n].head);if(!o||t.indexOf(o)%2!=0)return b.Pass}r.operation(function(){var e=r.lineSeparator()||"\n";r.replaceSelection(e+e,null),r.execCommand("goCharLeft"),i=r.listSelections();for(var t=0;t<i.length;t++){var n=i[t].head.line;r.indentLine(n,null,!0),r.indentLine(n+1,null,!0)}})}};function r(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),r="'"+n+"'";i[r]||(i[r]=function(t){return function(e){return function(i,e){var t=P(i);if(!t||i.getOption("disableInput"))return b.Pass;var n=x(t,"pairs"),r=n.indexOf(e);if(-1==r)return b.Pass;for(var o,a=x(t,"closeBefore"),s=x(t,"triples"),l=n.charAt(r+1)==e,c=i.listSelections(),f=r%2==0,h=0;h<c.length;h++){var u,d=c[h],p=d.head,g=i.getRange(p,C(p.line,p.ch+1));if(f&&!d.empty())u="surround";else if(!l&&f||g!=e)if(l&&1<p.ch&&0<=s.indexOf(e)&&i.getRange(C(p.line,p.ch-2),p)==e+e){if(2<p.ch&&/\bstring/.test(i.getTokenTypeAt(C(p.line,p.ch-2))))return b.Pass;u="addFour"}else if(l){d=0==p.ch?" ":i.getRange(C(p.line,p.ch-1),p);if(b.isWordChar(g)||d==e||b.isWordChar(d))return b.Pass;u="both"}else{if(!f||!(0===g.length||/\s/.test(g)||-1<a.indexOf(g)))return b.Pass;u="both"}else u=l&&function(e,t){var n=e.getTokenAt(C(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}(i,p)?"both":0<=s.indexOf(e)&&i.getRange(p,C(p.line,p.ch+3))==e+e+e?"skipThree":"skip";if(o){if(o!=u)return b.Pass}else o=u}var v=r%2?n.charAt(r-1):e,m=r%2?e:n.charAt(r+1);i.operation(function(){if("skip"==o)i.execCommand("goCharRight");else if("skipThree"==o)for(var e=0;e<3;e++)i.execCommand("goCharRight");else if("surround"==o){for(var t=i.getSelections(),e=0;e<t.length;e++)t[e]=v+t[e]+m;i.replaceSelections(t,"around"),t=i.listSelections().slice();for(e=0;e<t.length;e++)t[e]=(n=t[e],r=void 0,r=0<b.cmpPos(n.anchor,n.head),{anchor:new C(n.anchor.line,n.anchor.ch+(r?-1:1)),head:new C(n.head.line,n.head.ch+(r?1:-1))});i.setSelections(t)}else"both"==o?(i.replaceSelection(v+m,null),i.triggerElectric(v+m),i.execCommand("goCharLeft")):"addFour"==o&&(i.replaceSelection(v+v+v+v,"before"),i.execCommand("goCharRight"));var n,r})}(e,t)}}(n))}}function P(e){var t=e.state.closeBrackets;return t&&!t.override&&e.getModeAt(e.getCursor()).closeBrackets||t}function s(e,t){t=e.getRange(C(t.line,t.ch-1),C(t.line,t.ch+1));return 2==t.length?t:null}r(n.pairs+"`")});